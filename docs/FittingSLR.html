<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Simple Linear Regression: fitting a model to data – Introduction to Linear Regression in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d9ea66fcd6c317012447f26e9c021348.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/foldbox/foldbox.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glossary/glossary.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<style>
.Example {
  --color1: #BBDEFB;
  --color2: #2196F3;
}
.Assumption {
  --color1: #FFCDD2;
  --color2: #F44336;
}
.Exercise {
  --color1: #C8E6C9;
  --color2: #4CAF50;
}
.Technical-point {
  --color1: #C8E6C9;
  --color2: #4CAF50;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./FittingSLR.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple Linear Regression: fitting a model to data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Linear Regression in R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LinearModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">An introduction to linear statistical models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./FittingSLR.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple Linear Regression: fitting a model to data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MultipleLinearRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multiple Linear Regression: Building more complex models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./RegressionCase.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Regression case study</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Glossary</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Simple Linear Regression: fitting a model to data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell" data-edit="false">
<div>
<div id="webr-1" class="exercise-cell">

</div>
<script type="webr-1-contents">
eyJhdHRyIjp7ImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJvdXRwdXQiOmZhbHNlfSwiY29kZSI6IndlYnI6Omluc3RhbGwoXCJncmFkZXRoaXNcIiwgcXVpZXQgPSBUUlVFKVxubGlicmFyeShncmFkZXRoaXMpXG5vcHRpb25zKHdlYnIuZXhlcmNpc2UuY2hlY2tlciA9IGZ1bmN0aW9uKFxuICBsYWJlbCwgdXNlcl9jb2RlLCBzb2x1dGlvbl9jb2RlLCBjaGVja19jb2RlLCBlbnZpcl9yZXN1bHQsIGV2YWx1YXRlX3Jlc3VsdCxcbiAgZW52aXJfcHJlcCwgbGFzdF92YWx1ZSwgZW5naW5lLCBzdGFnZSwgLi4uXG4pIHtcbiAgaWYgKGlzLm51bGwoY2hlY2tfY29kZSkpIHtcbiAgICAjIE5vIGdyYWRpbmcgY29kZSwgc28ganVzdCBza2lwIGdyYWRpbmdcbiAgICBpbnZpc2libGUoTlVMTClcbiAgfSBlbHNlIGlmIChpcy5udWxsKGxhYmVsKSkge1xuICAgIGxpc3QoXG4gICAgICBjb3JyZWN0ID0gRkFMU0UsXG4gICAgICB0eXBlID0gXCJ3YXJuaW5nXCIsXG4gICAgICBtZXNzYWdlID0gXCJBbGwgZXhlcmNpc2VzIG11c3QgaGF2ZSBhIGxhYmVsLlwiXG4gICAgKVxuICB9IGVsc2UgaWYgKGlzLm51bGwoc29sdXRpb25fY29kZSkpIHtcbiAgICBsaXN0KFxuICAgICAgY29ycmVjdCA9IEZBTFNFLFxuICAgICAgdHlwZSA9IFwid2FybmluZ1wiLFxuICAgICAgbWVzc2FnZSA9IGh0bWx0b29sczo6dGFncyRkaXYoXG4gICAgICAgIGh0bWx0b29sczo6dGFncyRwKFwiQSBwcm9ibGVtIG9jY3VycmVkIGdyYWRpbmcgdGhpcyBleGVyY2lzZS5cIiksXG4gICAgICAgIGh0bWx0b29sczo6dGFncyRwKFxuICAgICAgICAgIFwiTm8gc29sdXRpb24gY29kZSB3YXMgZm91bmQuIE5vdGUgdGhhdCBncmFkaW5nIGV4ZXJjaXNlcyB1c2luZyB0aGUgXCIsXG4gICAgICAgICAgaHRtbHRvb2xzOjp0YWdzJGNvZGUoXCJncmFkZXRoaXNcIiksXG4gICAgICAgICAgXCJwYWNrYWdlIHJlcXVpcmVzIGEgbW9kZWwgc29sdXRpb24gdG8gYmUgaW5jbHVkZWQgaW4gdGhlIGRvY3VtZW50LlwiXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gIH0gZWxzZSB7XG4gICAgZ3JhZGV0aGlzOjpncmFkZXRoaXNfZXhlcmNpc2VfY2hlY2tlcihcbiAgICAgIGxhYmVsID0gbGFiZWwsIHNvbHV0aW9uX2NvZGUgPSBzb2x1dGlvbl9jb2RlLCB1c2VyX2NvZGUgPSB1c2VyX2NvZGUsXG4gICAgICBjaGVja19jb2RlID0gY2hlY2tfY29kZSwgZW52aXJfcmVzdWx0ID0gZW52aXJfcmVzdWx0LFxuICAgICAgZXZhbHVhdGVfcmVzdWx0ID0gZXZhbHVhdGVfcmVzdWx0LCBlbnZpcl9wcmVwID0gZW52aXJfcHJlcCxcbiAgICAgIGxhc3RfdmFsdWUgPSBsYXN0X3ZhbHVlLCBzdGFnZSA9IHN0YWdlLCBlbmdpbmUgPSBlbmdpbmUpXG4gIH1cbn0pIn0=
</script>
</div>
</div>
<p>in the previous section, you were given a linear model - we knew the values of <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and even <span class="math inline">\(\sigma\)</span>. However, in most contexts we don’t know the true relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> in advance. Instead, we are given <em>data</em> and try to <em>infer</em> the values of <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span> based on this.</p>
<p>Indeed, at the end of the last session we generated data from a linear model. In preparation for this chapter, I simulated data from a linear model - your task here (and in regression generally) is to try an make a (educated) guess about what linear model (summarised by it’s values for <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\sigma\)</span>) produced this data.</p>
<section id="estimating-parameters" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="estimating-parameters"><span class="header-section-number">2.1</span> Estimating parameters</h2>
<section id="hats" class="level3">
<h3 class="anchored" data-anchor-id="hats">Hats</h3>
<p>lets distinguish our estimates from the ‘true’, underlying, parameter values by giving them <span class="math inline">\(\hat{\text{hats}}\)</span>. so, we have</p>
<p><span class="math display">\[
\hat{\beta_0}: \text{Estimated intercept}
\]</span> <span class="math display">\[
\hat{\beta_1}: \text{Estimated slope}
\]</span> <span class="math display">\[
\hat{\sigma}: \text{Estimated standard deviation}.
\]</span></p>
<p>We also define <span class="math inline">\(\hat{Y}\)</span> as the predicted value of <span class="math inline">\(Y\)</span> given our estimated model:</p>
<p><span class="math display">\[
\hat{Y}=\hat{\beta_0}+\hat{\beta_1}X
\]</span> Looking at some data, we try to find the values of our parameters that best ‘fit’ its distribution. Adjust the sliders below to find a line that you think fits the data:</p>
<div class="cell" data-export="linearData">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="79" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 78;"><span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span> d3<span class="op">.</span><span class="fu">randomNormal</span>(<span class="dv">0</span><span class="op">,</span><span class="dv">4</span> ))</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>noise <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> <span class="dv">50</span>}<span class="op">,</span> d3<span class="op">.</span><span class="fu">randomNormal</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span>))</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> x<span class="op">.</span><span class="fu">map</span>((xi<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="fl">0.5</span> <span class="op">*</span> xi <span class="op">-</span> <span class="dv">3</span> <span class="op">+</span> noise[i])</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>xRange <span class="op">=</span> d3<span class="op">.</span><span class="fu">extent</span>(x)</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>linearData <span class="op">=</span> x<span class="op">.</span><span class="fu">map</span>((xi<span class="op">,</span> i) <span class="kw">=&gt;</span> ({ <span class="dt">x</span><span class="op">:</span> xi<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> y[i] }))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="92" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 91;"><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>viewof b0adj_1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{</span><span class="sc">\b</span><span class="vs">eta_0}`</span><span class="sc">}</span><span class="vs">: Estimated Intercept (asjust)`</span>})</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>viewof b1_1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span>  <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{</span><span class="sc">\b</span><span class="vs">eta_1}`</span><span class="sc">}</span><span class="vs">: Estimated Slope`</span>})</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>b0_1 <span class="op">=</span> (<span class="op">-</span><span class="dv">3</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span>b1_1) <span class="op">+</span> b0adj_1</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>tex<span class="op">.</span><span class="fu">block</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{Y} = </span><span class="sc">${</span>b0_1<span class="sc">}</span><span class="vs"> + </span><span class="sc">${</span>b1_1<span class="sc">}</span><span class="vs">x`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="cell panel-fill">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="103" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 102;"><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>lineData_1 <span class="op">=</span> xRange<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> b1_1 <span class="op">*</span> x <span class="op">+</span> b0_1}))</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">line</span>(lineData_1<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span> })<span class="op">,</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(linearData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span> })</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> xRange }<span class="op">,</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="dv">10</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-3-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="Exercise-1" class="Exercise">
<details class="Exercise fbx-simplebox fbx-default" open=""><summary><strong>Exercise 1</strong></summary><div>
<p>What is your best estimate for the values of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> that best fit the given data?</p>
<div class="cell" data-exercise="ex_2.1" data-envir="Ex2" data-define="[&quot;beta_0_hat&quot;,&quot;beta_1_hat&quot;]">
<div>
<div id="webr-2" class="exercise-cell">

</div>
<script type="webr-2-contents">
eyJhdHRyIjp7ImRlZmluZSI6WyJiZXRhXzBfaGF0IiwiYmV0YV8xX2hhdCJdLCJlZGl0Ijp0cnVlLCJlbnZpciI6IkV4MiIsImV2YWwiOnRydWUsImV4ZXJjaXNlIjoiZXhfMi4xIn0sImNvZGUiOiJiZXRhXzBfaGF0IDwtIDEuMlxuYmV0YV8xX2hhdCA8LSAxMiJ9
</script>
</div>
</div>
<div class="webr-ojs-exercise exercise-solution d-none" data-exercise="ex_1">
<div class="cell" data-exercise="ex_2.1" data-solution="true">
<div class="webr-ojs-exercise exercise-solution d-none" data-exercise="ex_2.1">
<code id="interpolate-4" class="solution-code d-none"></code>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="interpolate-5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="cell wait" data-exercise="ex_2.1" data-envir="Ex2" data-check="true">
<script type="exercise-check-ex_2.1-contents">
eyJhdHRyIjp7ImNoZWNrIjp0cnVlLCJjbGFzcyI6IndhaXQiLCJlZGl0Ijp0cnVlLCJlbnZpciI6IkV4MiIsImV2YWwiOnRydWUsImV4ZXJjaXNlIjoiZXhfMi4xIn0sImNvZGUiOiJncmFkZV90aGlzKHtcbiAgaWYgKGlzLm51bWVyaWMoZ2V0KFwiYmV0YV8wX2hhdFwiLCBlbnZpciA9IC5lbnZpcl9yZXN1bHQpKSAmJiBpcy5udW1lcmljKGdldChcImJldGFfMV9oYXRcIiwgZW52aXIgPSAuZW52aXJfcmVzdWx0KSkpe3Bhc3MoXCJHb29kIGd1ZXNzIVwiKX1cbiAgZmFpbChcImJvdGggXFxcXCRcXFxcYmV0YV8xXFxcXCQgYW5kIGJldGFfMCBzaG91bGQgYmUgbnVtYmVyc1wiKVxufSkifQ==
</script>
</div>
</div></details>
</div>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"></h3>
<p>Ok great, so we have an estimate for our line-of-best-fit:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="149" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 148;"><span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>tex<span class="op">.</span><span class="fu">block</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{Y} = </span><span class="sc">${</span>beta_0_hat<span class="sc">}</span><span class="vs"> + </span><span class="sc">${</span>beta_1_hat<span class="sc">}\c</span><span class="vs">dot X`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<p>but what do we mean by ‘best’ fit here? How do we evaluate this estimate and maybe compare it to other estimates?</p>
<ul class="task-list">
<li><label><input type="checkbox">Continue</label></li>
</ul>
</section>
<section id="residuals" class="level3">
<h3 class="anchored" data-anchor-id="residuals">Residuals</h3>
<p>Residuals are the difference between observed values of <span class="math inline">\(Y\)</span> (the points in the above scatter plot), and the value expected (or predicted) by our estimated linear predictor <span class="math inline">\(\hat{Y} = \hat{\beta_0}+\hat{\beta_1}X\)</span>. We denote residuals with the letter <span class="math inline">\(e\)</span>: <span class="math display">\[
e=Y-\hat{Y} = Y - \hat{\beta_0}+\hat{\beta_1}X.
\]</span></p>
<p>Residuals, <span class="math inline">\(e\)</span>, are similar to the errors, <span class="math inline">\(\varepsilon\)</span>, that we encountered in chapter 1 - but they are distinct. In many situations, we do not know the values of <span class="math inline">\(\beta_0\)</span> an <span class="math inline">\(\beta_1\)</span> - so we cannot calculate the errors, <span class="math inline">\(\varepsilon= Y- E[Y]= Y-\beta_0 + \beta_1 X\)</span>. However, we have are our estimates, <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span>, so we can calculate residuals.</p>
<p>Indeed - calculating residuals gives us a way to assess how well our estimated model fits the data. We can think of the residuals as being the ‘mismatch’ between our estimated linear predictor and each data point. By <em>minimizing</em> the size of residuals, we can get a better fit of our line to data.</p>
<ul class="task-list">
<li><label><input type="checkbox">Continue</label></li>
</ul>
</section>
<section id="estimating-beta-by-minimising-residuals" class="level3">
<h3 class="anchored" data-anchor-id="estimating-beta-by-minimising-residuals">Estimating <span class="math inline">\(\beta\)</span> by minimising residuals</h3>
<section id="guess-the-linear-predictor-how-low-can-the-residuals-go" class="level4">
<h4 class="anchored" data-anchor-id="guess-the-linear-predictor-how-low-can-the-residuals-go">Guess the linear predictor (how low can the residuals go)?</h4>
<p>Our estimated line now also displays residuals for each data point. Underneath the model equation is the <em>Sum of Squared Residuals</em> (SSR), which adds up all the residuals (the square means that they are all positive).</p>
<p><span class="math display">\[
SSR=\sum_{i=1}^{n} e_i^2
\]</span></p>
<p>This gives us a numerical measure of how well the line fits the data - see how low you can get the SSR by adjusting slope and intercept.</p>
<p><span class="math display">\[
e_i = Y_i - \hat{Y}_i
\]</span></p>
<div class="panel-grid layout-sidebar ms-md-0 layout-sidebar-left">
<div class="cell panel-sidebar card bg-light p-2 g-col-24 g-col-lg-7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="190" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 189;"><span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>viewof b0adj <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">5</span><span class="op">,</span> <span class="dv">5</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{</span><span class="sc">\b</span><span class="vs">eta_0}`</span><span class="sc">}</span><span class="vs">: Estimated Intercept`</span>})</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>viewof b1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">,</span> {<span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span>  <span class="fu">html</span><span class="vs">`</span><span class="sc">${</span><span class="fu">tex</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{</span><span class="sc">\b</span><span class="vs">eta_1}`</span><span class="sc">}</span><span class="vs">: Estimated Slope`</span>})</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>b0 <span class="op">=</span> <span class="op">-</span><span class="dv">3</span> <span class="op">+</span> b0adj</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>residualData <span class="op">=</span> linearData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yhat <span class="op">=</span> b1 <span class="op">*</span> d<span class="op">.</span><span class="at">x</span> <span class="op">+</span> b0<span class="op">;</span></span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> res  <span class="op">=</span> d<span class="op">.</span><span class="at">y</span> <span class="op">-</span> yhat<span class="op">;</span></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>    yhat<span class="op">,</span></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>    <span class="dt">residual</span><span class="op">:</span> res<span class="op">,</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sign</span><span class="op">:</span> res <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"positive"</span> <span class="op">:</span> <span class="st">"negative"</span><span class="op">,</span></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>    <span class="dt">absRes</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(res)</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>SSRes <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(residualData<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">residual</span> <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>tex<span class="op">.</span><span class="fu">block</span><span class="vs">`</span><span class="sc">\h</span><span class="vs">at{Y} = </span><span class="sc">${</span>b1<span class="sc">}</span><span class="vs">X + </span><span class="sc">${</span>b0<span class="sc">}</span><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-6" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="211" data-source-offset="-541"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 210;"><span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>tex<span class="op">.</span><span class="fu">block</span><span class="vs">`</span><span class="sc">\s</span><span class="vs">um_{i}r_i^{2} = </span><span class="sc">${</span>SSRes<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-5-7" data-nodetype="expression">

</div>
</div>
</div>
</div>
<div class="panel-fill panel-grid g-col-24 g-col-lg-17 pt-3 pt-lg-0">
<div class="g-col-24">
<div class="cell panel-fill">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="217" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 216;"><span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>lineData <span class="op">=</span> xRange<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> ({x<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> b1 <span class="op">*</span> x <span class="op">+</span> b0}))</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(residualData<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> <span class="st">"yhat"</span><span class="op">,</span></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"sign"</span><span class="op">,</span> </span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeOpacity</span><span class="op">:</span> <span class="fl">0.75</span><span class="op">,</span></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="dv">1</span> <span class="op">+</span> d<span class="op">.</span><span class="at">residual</span><span class="op">**</span><span class="dv">2</span>})<span class="op">,</span></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">line</span>(lineData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span> })<span class="op">,</span></span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(linearData<span class="op">,</span> { <span class="dt">x</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"y"</span><span class="op">,</span> <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span> })</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> xRange }<span class="op">,</span></span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="dv">10</span><span class="op">,</span><span class="dv">5</span>]<span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"y"</span> }<span class="op">,</span></span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-6-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="Exercise-2" class="Exercise">
<details class="Exercise fbx-simplebox fbx-default" open=""><summary><strong>Exercise 2</strong></summary><div>
<p>Based on this visualisation, what do you think the minimum possible <span class="math inline">\(SSR\)</span> achievable is?</p>
<div class="cell" data-exercise="Ex_2.2" data-envir="Ex2" data-define="SSR">
<div>
<div id="webr-7" class="exercise-cell">

</div>
<script type="webr-7-contents">
eyJhdHRyIjp7ImRlZmluZSI6WyJTU1IiXSwiZWRpdCI6dHJ1ZSwiZW52aXIiOiJFeDIiLCJldmFsIjp0cnVlLCJleGVyY2lzZSI6IkV4XzIuMiJ9LCJjb2RlIjoiU1NSIDwtIDUwIn0=
</script>
</div>
</div>
<div class="webr-ojs-exercise exercise-solution d-none" data-exercise="Ex_2.2">
<div class="cell" data-exercise="Ex_2.2" data-solution="true">
<div class="webr-ojs-exercise exercise-solution d-none" data-exercise="Ex_2.2">
<code id="interpolate-9" class="solution-code d-none"></code>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="interpolate-10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="cell wait" data-exercise="Ex_2.2" data-check="true">
<script type="exercise-check-Ex_2.2-contents">
eyJhdHRyIjp7ImNoZWNrIjp0cnVlLCJjbGFzcyI6IndhaXQiLCJlZGl0Ijp0cnVlLCJldmFsIjp0cnVlLCJleGVyY2lzZSI6IkV4XzIuMiJ9LCJjb2RlIjoiZ3JhZGVfdGhpcyh7XG4gIGlmIChpcy5udW1lcmljKGdldChcIlNTUlwiLCBlbnZpciA9IC5lbnZpcl9yZXN1bHQpKSl7XG4gICAgcGFzcyhcIkdvb2QgZ3Vlc3MhXCIpfVxuICBmYWlsKFwiU1NSIHNob3VsZCBiZSBhIG51bWJlciFcIilcbn0pIn0=
</script>
</div>
<p>If you want you can update your <span class="math inline">\(\hat{\beta}\)</span> estimates too (otherwise just proceed):</p>
<div class="cell" data-exercise="ex_2.3" data-envir="Ex2">
<div>
<div id="webr-12" class="exercise-cell">

</div>
<script type="webr-12-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImVudmlyIjoiRXgyIiwiZXZhbCI6dHJ1ZSwiZXhlcmNpc2UiOiJleF8yLjMifSwiY29kZSI6ImJldGFfMF9oYXQgPC0gX19fX19fXG5cbmJldGFfMV9oYXQgPC0gX19fX19fIn0=
</script>
</div>
</div>
</div></details>
</div>
<div id="why-squares" class="Technical-point" title="Why squares?">
<p></p><details class="Technical-point fbx-simplebox fbx-default"><summary><strong>Technical-point 1: </strong>Why squares?</summary><div>The least squares estimator chooses <span class="math inline">\(\hat \beta_0\)</span> and <span class="math inline">\(\hat \beta_1\)</span> so that the sum of squared residuals <span class="math inline">\(\sum_{i=1}^{n} r_i^2\)</span> is as small as possible. But why take squares? As mentioned, squaring numbers returns a positive result. Therefore the square gives some idea of the ‘absolute’ value of the residuals (and doesn’t allow negative residuals to cancel out positve ones). But why not just take the absolute value? Because the square function penalises large deviations heavily, least squares prefers lines that keep every point reasonably close to the fitted value rather than letting a few points drift far away.<p></p>
</div></details>
</div>
</section>
</section>
<section id="fitting-a-model-using-least-squares" class="level3">
<h3 class="anchored" data-anchor-id="fitting-a-model-using-least-squares">Fitting a model using least squares</h3>
<p>We call the estimates <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> which minimise the sum of squares the <em>least squares estimates</em>. Some nice mathematics tells us that the least squares esimates for a simple linear model are <em>unique</em> - that is, there is one set of values for <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> which satisfy this property. Moreover, we don’t have to manually adjust our parameters to keep lowering SSR - there is a convenient closed form expression which allows us to compute <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> very efficiently. As a statistical programming language, this is something R does very easily..</p>
<section id="the-lm-function" class="level4">
<h4 class="anchored" data-anchor-id="the-lm-function">The <code>lm()</code> function</h4>
<p>In R the <code>lm()</code> function computes the least squares estimates <span class="math inline">\(\hat{\beta_0}\)</span> and <span class="math inline">\(\hat{\beta_1}\)</span> for our simple linear model in a single command, printing both of the fitted coefficients.</p>
<div class="cell" data-input="linearData">
<div>
<div id="webr-13" class="exercise-cell">

</div>
<script type="webr-13-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWUsImlucHV0IjpbImxpbmVhckRhdGEiXX0sImNvZGUiOiJsbV8xIDwtIGxtKHl+eCxsaW5lYXJEYXRhKVxubG1fMSJ9
</script>
</div>
</div>
<p>How do these estimates compare with yours? Lets have a look at the line it produces.</p>
<div class="cell" data-envir="Ex2">
<div>
<div id="webr-14" class="exercise-cell">

</div>
<script type="webr-14-contents">
eyJhdHRyIjp7ImNvZGUtZm9sZCI6dHJ1ZSwiY29kZS1zdW1tYXJ5Ijoic2hvdyBjb2RlIiwiZWRpdCI6dHJ1ZSwiZW52aXIiOiJFeDIiLCJldmFsIjp0cnVlfSwiY29kZSI6IiMgd2UgZXh0cmFjdCB0aGUgY29lZmZpY2llbnRzIGZyb20gdGhlIGxtIG9iamVjdCBieSBpbmRleGluZyB3aXRoIGAkYFxubHNfYmV0YV8wX2hhdCA8LSBsbV8xJGNvZWZmaWNpZW50c1sxXVxubHNfYmV0YV8xX2hhdCA8LSBsbV8xJGNvZWZmaWNpZW50c1syXVxuXG5nZ3Bsb3QobGluZWFyRGF0YSkrXG4gIGFlcyh4PXgseT15KStcbiAgZ2VvbV9wb2ludCgpK1xuICBnZW9tX2FibGluZShcbiAgICBpbnRlcmNlcHQ9bHNfYmV0YV8wX2hhdCxcbiAgICBzbG9wZT1sc19iZXRhXzFfaGF0KStcbiAgICBnZW9tX2FibGluZShcbiAgICBpbnRlcmNlcHQ9YmV0YV8wX2hhdCxcbiAgICBzbG9wZT1iZXRhXzFfaGF0KSJ9
</script>
</div>
</div>
<ul class="task-list">
<li><label><input type="checkbox">Continue</label></li>
</ul>
</section>
</section>
<section id="estimating-sigma" class="level3">
<h3 class="anchored" data-anchor-id="estimating-sigma">Estimating <span class="math inline">\(\sigma\)</span></h3>
<p>Once the line has been fitted, we estimate the variance of the (actual) error terms by measuring the spread of the residuals.</p>
<p>Dividing the residual sum of squares by <span class="math inline">\(n-2\)</span> (one degree of freedom lost per fitted coefficient) gives the mean squared error, and taking the square root yields the residual standard deviation (aka. the <button class="glossary" title="the standard deviation of the residual distribution">Residual-Standard-Error</button>) <span class="math display">\[
\hat \sigma = \sqrt{\frac{1}{n-2}\sum_{i=1}^{n} r_i^2}.
\]</span> In R output, this value is often called the. Interpreting <span class="math inline">\(\hat \sigma\)</span> is often easier on the original <span class="math inline">\(y\)</span> scale: a typical observation falls about <span class="math inline">\(\hat \sigma\)</span> units away from the fitted line.</p>
</section>
<section id="estimating-by-the-spread-of-residuals" class="level3">
<h3 class="anchored" data-anchor-id="estimating-by-the-spread-of-residuals">Estimating by the spread of residuals</h3>
</section>
</section>
<section id="checking-assumptions" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="checking-assumptions"><span class="header-section-number">2.2</span> Checking assumptions</h2>
<section id="independence-of-observations" class="level3">
<h3 class="anchored" data-anchor-id="independence-of-observations">Independence of observations</h3>
<p>Linear regression relies on the observations being independent. Time series data or spatially linked measurements often violate this assumption. When in doubt, look for study-design clues (for example repeated measurements on the same participant) or plot the residuals in the order they were collected; long runs of positive or negative residuals suggest dependence.</p>
</section>
<section id="linear-relationships" class="level3">
<h3 class="anchored" data-anchor-id="linear-relationships">Linear relationships</h3>
<p>The expected response should change linearly with the predictor. Scatterplots of <span class="math inline">\((x_i, y_i)\)</span> and residual-versus-fitted plots are useful diagnostics. A curved pattern in either plot indicates that we may need a transformation or additional predictors to capture the relationship.</p>
</section>
<section id="constant-variance" class="level3">
<h3 class="anchored" data-anchor-id="constant-variance">Constant Variance</h3>
<p>Also called homoscedasticity, this assumption requires that the spread of the residuals remains roughly constant for all fitted values. Residual plots that show a funnel shape (narrow for small <span class="math inline">\(\hat y\)</span> but wide for large <span class="math inline">\(\hat y\)</span>) point to heteroscedasticity, in which case we might transform <span class="math inline">\(y\)</span>, use weighted least squares, or adopt a different variance model.</p>
</section>
<section id="normality-of-error" class="level3">
<h3 class="anchored" data-anchor-id="normality-of-error">Normality of error</h3>
<p>Least squares still works without normal errors, but the inference tools we use later (confidence intervals and hypothesis tests) rely on approximate normality of residuals. A normal Q-Q plot provides a quick check: substantial deviations from the diagonal line suggest heavier tails or skewness than the normal distribution.</p>
</section>
</section>
<section id="inference-for-simple-linear-regression" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="inference-for-simple-linear-regression"><span class="header-section-number">2.3</span> Inference for Simple Linear Regression</h2>
<section id="inference-about-sigma" class="level3">
<h3 class="anchored" data-anchor-id="inference-about-sigma">Inference about <span class="math inline">\(\sigma\)</span></h3>
<p>With the assumptions above in place, the scaled residual sum of squares follows a <span class="math inline">\(\chi^2_{n-2}\)</span> distribution. This allows us to build a confidence interval for <span class="math inline">\(\sigma\)</span> or to test competing claims about the error variance. In practice we use the R output <code>sigma</code> together with the degrees of freedom to construct intervals. ### Inference about <span class="math inline">\(\beta_1\)</span></p>
<p>To determine whether the predictor is associated with the response we frame the null hypothesis <span class="math inline">\(H_0: \beta_1 = 0\)</span> and use the t-statistic <span class="math display">\[
t = \frac{\hat \beta_1 - 0}{\operatorname{SE}(\hat \beta_1)}.
\]</span> The standard error is obtained from the fitted model and the test statistic is compared against a <span class="math inline">\(t_{n-2}\)</span> distribution. R reports the t-statistic, the corresponding p-value, and a confidence interval for <span class="math inline">\(\beta_1\)</span>, letting us draw formal conclusions about the strength and direction of the linear association.</p>
</section>
</section>
<section id="interpreting-summary-output" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="interpreting-summary-output"><span class="header-section-number">2.4</span> Interpreting `summary()` output</h2>
<p>The <code>summary()</code> function wraps all of these pieces into a single report. Focus on: - the coefficients table, which lists estimates, standard errors, t-values, and p-values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>; - the residual standard error and degrees of freedom, which relate to <span class="math inline">\(\hat \sigma\)</span> and the variability around the line; - the multiple <span class="math inline">\(R^2\)</span>, quantifying the proportion of variation in <span class="math inline">\(y\)</span> explained by the predictor; - the F-statistic, which matches the t-test for <span class="math inline">\(\beta_1\)</span> in the simple regression setting.</p>
<p>Interpreting each component in context helps translate the statistical output into practical insight about the data.</p>
</section>
<section id="using-the-model-for-prediction" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="using-the-model-for-prediction"><span class="header-section-number">2.5</span> Using the model for prediction</h2>
<p>After a model has been checked and deemed appropriate, we can use it to predict responses for new values of the predictor. In R the <code>predict()</code> function returns both fitted values (point predictions) and prediction intervals that account for residual variability. When reporting predictions always state the uncertainty, because individual observations vary more than the fitted mean. Remember that predictions are most reliable for <span class="math inline">\(x\)</span> values within the range of the observed data; extrapolating far beyond the sample can produce misleading results.</p>
<script type="webr-data">
eyJvcHRpb25zIjp7ImJhc2VVcmwiOiJodHRwczovL3dlYnIuci13YXNtLm9yZy92MC41LjQvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsiZXZhbHVhdGUiLCJrbml0ciIsImh0bWx0b29scyJdLCJyZXBvcyI6W119LCJyZW5kZXJfZGYiOiJkZWZhdWx0In0=
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTQ7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xNCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzE0ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTQtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xNCA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfMTM7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xMyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzEzID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMTMtY29udGVudHNcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBibG9jayA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKHNjcmlwdENvbnRlbnQpKTtcblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IGlkOiBgd2Vici0xMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fd2Vicl92YWx1ZV8xMyA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTMsIHtsaW5lYXJEYXRhfSk7XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtMTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzEyO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl8xMiA9IHtcbiAgY29uc3QgeyBXZWJSRXhlcmNpc2VFZGl0b3IsIGI2NERlY29kZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLTEyLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBleGVyY2lzZSBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKFxuICAgIHtcbiAgICAgIGlkOiBcIndlYnItMTItY29udGVudHNcIixcbiAgICAgIGVudmlyOiBgZXhlcmNpc2UtZW52LSR7YmxvY2suYXR0ci5leGVyY2lzZX1gLFxuICAgICAgZXJyb3I6IGZhbHNlLFxuICAgICAgY2FwdGlvbjogJ0V4ZXJjaXNlJyxcbiAgICB9LFxuICAgIGJsb2NrLmF0dHJcbiAgKTtcblxuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbnZpZXdvZiBfd2Vicl92YWx1ZV8xMiA9IHdlYlJPanMucHJvY2Vzcyhfd2Vicl9lZGl0b3JfMTIsIHt9KTtcbl93ZWJyX2ZlZWRiYWNrXzEyID0ge1xuICBjb25zdCB7IFdlYlJHcmFkZXIgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IGVtcHR5RmVlZGJhY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjb25zdCBncmFkZXIgPSBuZXcgV2ViUkdyYWRlcihfd2Vicl92YWx1ZV8xMi5ldmFsdWF0b3IpO1xuICBjb25zdCBmZWVkYmFjayA9IGF3YWl0IGdyYWRlci5ncmFkZUV4ZXJjaXNlKCk7XG4gIGlmICghZmVlZGJhY2spIHJldHVybiBlbXB0eUZlZWRiYWNrO1xuICByZXR1cm4gZmVlZGJhY2s7XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici13aWRnZXQtNyIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgLy8gV2FpdCBmb3Igb3V0cHV0IHRvIGJlIHdyaXR0ZW4gdG8gdGhlIERPTSwgdGhlbiB0cmlnZ2VyIHdpZGdldCByZW5kZXJpbmdcbiAgYXdhaXQgX3dlYnJfdmFsdWVfNztcbiAgaWYgKHdpbmRvdy5IVE1MV2lkZ2V0cykge1xuICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTtcbiAgfVxuICBpZiAod2luZG93LlBhZ2VkVGFibGVEb2MpIHtcbiAgICB3aW5kb3cuUGFnZWRUYWJsZURvYy5pbml0QWxsKCk7XG4gIH1cbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF93ZWJyX2VkaXRvcl83ID0ge1xuICBjb25zdCB7IFdlYlJFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItNy1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXhlcmNpc2UgY29uZmlndXJhdGlvblxuICBjb25zdCBvcHRpb25zID0gT2JqZWN0LmFzc2lnbihcbiAgICB7XG4gICAgICBpZDogXCJ3ZWJyLTctY29udGVudHNcIixcbiAgICAgIGVudmlyOiBgZXhlcmNpc2UtZW52LSR7YmxvY2suYXR0ci5leGVyY2lzZX1gLFxuICAgICAgZXJyb3I6IGZhbHNlLFxuICAgICAgY2FwdGlvbjogJ0V4ZXJjaXNlJyxcbiAgICB9LFxuICAgIGJsb2NrLmF0dHJcbiAgKTtcblxuICBjb25zdCBlZGl0b3IgPSBuZXcgV2ViUkV4ZXJjaXNlRWRpdG9yKHdlYlJPanMud2ViUlByb21pc2UsIGJsb2NrLmNvZGUsIG9wdGlvbnMpO1xuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbnZpZXdvZiBfd2Vicl92YWx1ZV83ID0gd2ViUk9qcy5wcm9jZXNzKF93ZWJyX2VkaXRvcl83LCB7fSk7XG5fd2Vicl9mZWVkYmFja183ID0ge1xuICBjb25zdCB7IFdlYlJHcmFkZXIgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IGVtcHR5RmVlZGJhY2sgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuICBjb25zdCBncmFkZXIgPSBuZXcgV2ViUkdyYWRlcihfd2Vicl92YWx1ZV83LmV2YWx1YXRvcik7XG4gIGNvbnN0IGZlZWRiYWNrID0gYXdhaXQgZ3JhZGVyLmdyYWRlRXhlcmNpc2UoKTtcbiAgaWYgKCFmZWVkYmFjaykgcmV0dXJuIGVtcHR5RmVlZGJhY2s7XG4gIHJldHVybiBmZWVkYmFjaztcbn1cbiJ9LHsiY2VsbE5hbWUiOiJ3ZWJyLXdpZGdldC0yIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICAvLyBXYWl0IGZvciBvdXRwdXQgdG8gYmUgd3JpdHRlbiB0byB0aGUgRE9NLCB0aGVuIHRyaWdnZXIgd2lkZ2V0IHJlbmRlcmluZ1xuICBhd2FpdCBfd2Vicl92YWx1ZV8yO1xuICBpZiAod2luZG93LkhUTUxXaWRnZXRzKSB7XG4gICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpO1xuICB9XG4gIGlmICh3aW5kb3cuUGFnZWRUYWJsZURvYykge1xuICAgIHdpbmRvdy5QYWdlZFRhYmxlRG9jLmluaXRBbGwoKTtcbiAgfVxufVxuIn0seyJjZWxsTmFtZSI6IndlYnItMiIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJzb3VyY2UiOiJ2aWV3b2YgX3dlYnJfZWRpdG9yXzIgPSB7XG4gIGNvbnN0IHsgV2ViUkV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwid2Vici0yLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBleGVyY2lzZSBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKFxuICAgIHtcbiAgICAgIGlkOiBcIndlYnItMi1jb250ZW50c1wiLFxuICAgICAgZW52aXI6IGBleGVyY2lzZS1lbnYtJHtibG9jay5hdHRyLmV4ZXJjaXNlfWAsXG4gICAgICBlcnJvcjogZmFsc2UsXG4gICAgICBjYXB0aW9uOiAnRXhlcmNpc2UnLFxuICAgIH0sXG4gICAgYmxvY2suYXR0clxuICApO1xuXG4gIGNvbnN0IGVkaXRvciA9IG5ldyBXZWJSRXhlcmNpc2VFZGl0b3Iod2ViUk9qcy53ZWJSUHJvbWlzZSwgYmxvY2suY29kZSwgb3B0aW9ucyk7XG4gIHJldHVybiBlZGl0b3IuY29udGFpbmVyO1xufVxudmlld29mIF93ZWJyX3ZhbHVlXzIgPSB3ZWJST2pzLnByb2Nlc3MoX3dlYnJfZWRpdG9yXzIsIHt9KTtcbl93ZWJyX2ZlZWRiYWNrXzIgPSB7XG4gIGNvbnN0IHsgV2ViUkdyYWRlciB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3QgZW1wdHlGZWVkYmFjayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gIGNvbnN0IGdyYWRlciA9IG5ldyBXZWJSR3JhZGVyKF93ZWJyX3ZhbHVlXzIuZXZhbHVhdG9yKTtcbiAgY29uc3QgZmVlZGJhY2sgPSBhd2FpdCBncmFkZXIuZ3JhZGVFeGVyY2lzZSgpO1xuICBpZiAoIWZlZWRiYWNrKSByZXR1cm4gZW1wdHlGZWVkYmFjaztcbiAgcmV0dXJuIGZlZWRiYWNrO1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItd2lkZ2V0LTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJ7XG4gIC8vIFdhaXQgZm9yIG91dHB1dCB0byBiZSB3cml0dGVuIHRvIHRoZSBET00sIHRoZW4gdHJpZ2dlciB3aWRnZXQgcmVuZGVyaW5nXG4gIGF3YWl0IF93ZWJyX3ZhbHVlXzE7XG4gIGlmICh3aW5kb3cuSFRNTFdpZGdldHMpIHtcbiAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7XG4gIH1cbiAgaWYgKHdpbmRvdy5QYWdlZFRhYmxlRG9jKSB7XG4gICAgd2luZG93LlBhZ2VkVGFibGVEb2MuaW5pdEFsbCgpO1xuICB9XG59XG4ifSx7ImNlbGxOYW1lIjoid2Vici0xIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6Il93ZWJyX3ZhbHVlXzEgPSB7XG4gIGNvbnN0IHsgaGlnaGxpZ2h0UiwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBzY3JpcHRDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcIndlYnItMS1jb250ZW50c1xcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGJsb2NrID0gSlNPTi5wYXJzZShiNjREZWNvZGUoc2NyaXB0Q29udGVudCkpO1xuXG4gIC8vIERlZmF1bHQgZXZhbHVhdGlvbiBjb25maWd1cmF0aW9uXG4gIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICBpZDogXCJ3ZWJyLTEtY29udGVudHNcIixcbiAgICBlY2hvOiB0cnVlLFxuICAgIG91dHB1dDogdHJ1ZVxuICB9LCBibG9jay5hdHRyKTtcblxuICAvLyBFdmFsdWF0ZSB0aGUgcHJvdmlkZWQgUiBjb2RlXG4gIGNvbnN0IHJlc3VsdCA9IHdlYlJPanMucHJvY2Vzcyh7Y29kZTogYmxvY2suY29kZSwgb3B0aW9uc30sIHt9KTtcblxuICAvLyBFYXJseSB5aWVsZCB3aGlsZSB3ZSB3YWl0IGZvciB0aGUgZmlyc3QgZXZhbHVhdGlvbiBhbmQgcmVuZGVyXG4gIGlmIChvcHRpb25zLm91dHB1dCAmJiAhKFwiMVwiIGluIHdlYlJPanMucmVuZGVyZWRPanMpKSB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcblxuICAgIGlmIChvcHRpb25zLmVjaG8pIHtcbiAgICAgIC8vIFNob3cgb3V0cHV0IGFzIGhpZ2hsaWdodGVkIHNvdXJjZVxuICAgICAgY29uc3QgcHJlRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwcmVcIik7XG4gICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJzb3VyY2VDb2RlXCI7XG4gICAgICBwcmVFbGVtLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZSByXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFIoYmxvY2suY29kZSkpO1xuICAgICAgc3Bpbm5lci5jbGFzc05hbWUgPSBcInNwaW5uZXItZ3JvdyBzcGlubmVyLWdyb3ctc20gbS0yIHBvc2l0aW9uLWFic29sdXRlIHRvcC0wIGVuZC0wXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHByZUVsZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ib3JkZXIgc3Bpbm5lci1ib3JkZXItc21cIjtcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcGlubmVyKTtcbiAgICB9XG5cbiAgICB5aWVsZCBjb250YWluZXI7XG4gIH1cblxuICB3ZWJST2pzLnJlbmRlcmVkT2pzW1wiMVwiXSA9IHRydWU7XG4gIHlpZWxkIGF3YWl0IHJlc3VsdDtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJpbnRlcnBvbGF0ZS00IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICBjb25zdCB7IGludGVycG9sYXRlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBibG9ja19pZCA9IFwiNFwiO1xuICBjb25zdCBsYW5ndWFnZSA9IFwibm9uZVwiO1xuICBjb25zdCBkZWZfbWFwID0ge1xufTtcbiAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbnRlcnBvbGF0ZS0ke2Jsb2NrX2lkfWApO1xuXG4gIC8vIFN0b3JlIG9yaWdpbmFsIHRlbXBsYXRlZCBIVE1MIGZvciByZWZlcmVuY2UgaW4gZnV0dXJlIHJlYWN0aXZlIHVwZGF0ZXNcbiAgaWYgKCFlbGVtLm9yaWdIVE1MKSBlbGVtLm9yaWdIVE1MID0gZWxlbS5pbm5lckhUTUw7XG5cbiAgLy8gSW50ZXJwb2xhdGUgcmVhY3RpdmUgT0pTIHZhcmlhYmxlcyBpbnRvIGVzdGFibGlzaGVkIEhUTUwgZWxlbWVudFxuICBlbGVtLmlubmVySFRNTCA9IGVsZW0ub3JpZ0hUTUw7XG4gIE9iamVjdC5rZXlzKGRlZl9tYXApLmZvckVhY2goKGRlZikgPT5cbiAgICBpbnRlcnBvbGF0ZShlbGVtLCBcIiR7XCIgKyBkZWYgKyBcIn1cIiwgZGVmX21hcFtkZWZdLCBsYW5ndWFnZSlcbiAgKTtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJpbnRlcnBvbGF0ZS01IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICBjb25zdCB7IGludGVycG9sYXRlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBibG9ja19pZCA9IFwiNVwiO1xuICBjb25zdCBsYW5ndWFnZSA9IFwiclwiO1xuICBjb25zdCBkZWZfbWFwID0ge1xufTtcbiAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbnRlcnBvbGF0ZS0ke2Jsb2NrX2lkfWApO1xuXG4gIC8vIFN0b3JlIG9yaWdpbmFsIHRlbXBsYXRlZCBIVE1MIGZvciByZWZlcmVuY2UgaW4gZnV0dXJlIHJlYWN0aXZlIHVwZGF0ZXNcbiAgaWYgKCFlbGVtLm9yaWdIVE1MKSBlbGVtLm9yaWdIVE1MID0gZWxlbS5pbm5lckhUTUw7XG5cbiAgLy8gSW50ZXJwb2xhdGUgcmVhY3RpdmUgT0pTIHZhcmlhYmxlcyBpbnRvIGVzdGFibGlzaGVkIEhUTUwgZWxlbWVudFxuICBlbGVtLmlubmVySFRNTCA9IGVsZW0ub3JpZ0hUTUw7XG4gIE9iamVjdC5rZXlzKGRlZl9tYXApLmZvckVhY2goKGRlZikgPT5cbiAgICBpbnRlcnBvbGF0ZShlbGVtLCBcIiR7XCIgKyBkZWYgKyBcIn1cIiwgZGVmX21hcFtkZWZdLCBsYW5ndWFnZSlcbiAgKTtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJpbnRlcnBvbGF0ZS05IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoie1xuICBjb25zdCB7IGludGVycG9sYXRlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuICBjb25zdCBibG9ja19pZCA9IFwiOVwiO1xuICBjb25zdCBsYW5ndWFnZSA9IFwibm9uZVwiO1xuICBjb25zdCBkZWZfbWFwID0ge1xufTtcbiAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbnRlcnBvbGF0ZS0ke2Jsb2NrX2lkfWApO1xuXG4gIC8vIFN0b3JlIG9yaWdpbmFsIHRlbXBsYXRlZCBIVE1MIGZvciByZWZlcmVuY2UgaW4gZnV0dXJlIHJlYWN0aXZlIHVwZGF0ZXNcbiAgaWYgKCFlbGVtLm9yaWdIVE1MKSBlbGVtLm9yaWdIVE1MID0gZWxlbS5pbm5lckhUTUw7XG5cbiAgLy8gSW50ZXJwb2xhdGUgcmVhY3RpdmUgT0pTIHZhcmlhYmxlcyBpbnRvIGVzdGFibGlzaGVkIEhUTUwgZWxlbWVudFxuICBlbGVtLmlubmVySFRNTCA9IGVsZW0ub3JpZ0hUTUw7XG4gIE9iamVjdC5rZXlzKGRlZl9tYXApLmZvckVhY2goKGRlZikgPT5cbiAgICBpbnRlcnBvbGF0ZShlbGVtLCBcIiR7XCIgKyBkZWYgKyBcIn1cIiwgZGVmX21hcFtkZWZdLCBsYW5ndWFnZSlcbiAgKTtcbn1cbiJ9LHsiY2VsbE5hbWUiOiJpbnRlcnBvbGF0ZS0xMCIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IntcbiAgY29uc3QgeyBpbnRlcnBvbGF0ZSB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcbiAgY29uc3QgYmxvY2tfaWQgPSBcIjEwXCI7XG4gIGNvbnN0IGxhbmd1YWdlID0gXCJyXCI7XG4gIGNvbnN0IGRlZl9tYXAgPSB7XG59O1xuICBjb25zdCBlbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGludGVycG9sYXRlLSR7YmxvY2tfaWR9YCk7XG5cbiAgLy8gU3RvcmUgb3JpZ2luYWwgdGVtcGxhdGVkIEhUTUwgZm9yIHJlZmVyZW5jZSBpbiBmdXR1cmUgcmVhY3RpdmUgdXBkYXRlc1xuICBpZiAoIWVsZW0ub3JpZ0hUTUwpIGVsZW0ub3JpZ0hUTUwgPSBlbGVtLmlubmVySFRNTDtcblxuICAvLyBJbnRlcnBvbGF0ZSByZWFjdGl2ZSBPSlMgdmFyaWFibGVzIGludG8gZXN0YWJsaXNoZWQgSFRNTCBlbGVtZW50XG4gIGVsZW0uaW5uZXJIVE1MID0gZWxlbS5vcmlnSFRNTDtcbiAgT2JqZWN0LmtleXMoZGVmX21hcCkuZm9yRWFjaCgoZGVmKSA9PlxuICAgIGludGVycG9sYXRlKGVsZW0sIFwiJHtcIiArIGRlZiArIFwifVwiLCBkZWZfbWFwW2RlZl0sIGxhbmd1YWdlKVxuICApO1xufVxuIn0seyJjZWxsTmFtZSI6IndlYnItcHJlbHVkZSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6IndlYlJPanMgPSB7XG4gIGNvbnN0IHsgV2ViUiwgQ2hhbm5lbFR5cGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWUuV2ViUjtcbiAgY29uc3Qge1xuICAgIFdlYlJFdmFsdWF0b3IsXG4gICAgV2ViUkVudmlyb25tZW50TWFuYWdlcixcbiAgICBzZXR1cFIsXG4gICAgYjY0RGVjb2RlLFxuICAgIGNvbGxhcHNlUGF0aFxuICB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcblxuICBjb25zdCBzdGF0dXNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV4ZXJjaXNlLWxvYWRpbmctc3RhdHVzXCIpO1xuICBjb25zdCBpbmRpY2F0b3JDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpbmRpY2F0b3JDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcImQtbm9uZVwiKTtcblxuICBsZXQgc3RhdHVzVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgc3RhdHVzVGV4dC5jbGFzc0xpc3QgPSBcImV4ZXJjaXNlLWxvYWRpbmctZGV0YWlsc1wiO1xuICBzdGF0dXNUZXh0ID0gc3RhdHVzQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXR1c1RleHQpO1xuICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYEluaXRpYWxpc2VgO1xuXG4gIC8vIEhvaXN0IGluZGljYXRvciBvdXQgZnJvbSBmaW5hbCBzbGlkZSB3aGVuIHJ1bm5pbmcgdW5kZXIgcmV2ZWFsXG4gIGNvbnN0IHJldmVhbFN0YXR1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsIC5leGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaWYgKHJldmVhbFN0YXR1cykge1xuICAgIHJldmVhbFN0YXR1cy5yZW1vdmUoKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCA+IC5zbGlkZXNcIikuYXBwZW5kQ2hpbGQocmV2ZWFsU3RhdHVzKTtcbiAgfVxuXG4gIC8vIE1ha2UgYW55IHJldmVhbCBzbGlkZXMgd2l0aCBsaXZlIGNlbGxzIHNjcm9sbGFibGVcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXZlYWwgLmV4ZXJjaXNlLWNlbGxcIikuZm9yRWFjaCgoZWwpID0+IHtcbiAgICBlbC5jbG9zZXN0KCdzZWN0aW9uLnNsaWRlJykuY2xhc3NMaXN0LmFkZChcInNjcm9sbGFibGVcIik7XG4gIH0pXG5cbiAgLy8gd2ViUiBzdXBwbGVtZW50YWwgZGF0YSBhbmQgb3B0aW9uc1xuICBjb25zdCBkYXRhQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJ3ZWJyLWRhdGFcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZGF0YUNvbnRlbnQpKTtcblxuICAvLyBHcmFiIGxpc3Qgb2YgcmVzb3VyY2VzIHRvIGJlIGRvd25sb2FkZWRcbiAgY29uc3QgZmlsZXNDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcInZmcy1maWxlXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZmlsZXMgPSBKU09OLnBhcnNlKGI2NERlY29kZShmaWxlc0NvbnRlbnQpKTtcblxuICAvLyBVc2UgUG9zdE1lc3NhZ2UgY2hhbm5lbCBmb3IgYXN5bmMgY29tbXVuaWNhdGlvblxuICAvLyBXZSBkbyBub3QgZXhwZWN0IHRvIHRha2UgbmVzdGVkIHByb21wdCBpbnB1dCBpbiBRdWFydG8gTGl2ZSBjZWxsc1xuICBkYXRhLm9wdGlvbnMuY2hhbm5lbFR5cGUgPSBDaGFubmVsVHlwZS5Qb3N0TWVzc2FnZTtcblxuICAvLyBJbml0aWFsaXNlIHdlYlIgYW5kIHNldHVwIGZvciBSIGNvZGUgZXZhbHVhdGlvblxuICBsZXQgd2ViUlByb21pc2UgPSAoYXN5bmMgKHdlYlIpID0+IHtcbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHdlYlJgO1xuICAgIGF3YWl0IHdlYlIuaW5pdCgpO1xuXG4gICAgLy8gSW5zdGFsbCBwcm92aWRlZCBsaXN0IG9mIHBhY2thZ2VzXG4gICAgLy8gRW5zdXJlIHdlYlIgZGVmYXVsdCByZXBvIGlzIGluY2x1ZGVkXG4gICAgZGF0YS5wYWNrYWdlcy5yZXBvcy5wdXNoKFwiaHR0cHM6Ly9yZXBvLnItd2FzbS5vcmdcIilcbiAgICBhd2FpdCBkYXRhLnBhY2thZ2VzLnBrZ3MubWFwKChwa2cpID0+ICgpID0+IHtcbiAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgcGFja2FnZTogJHtwa2d9YDtcbiAgICAgIHJldHVybiB3ZWJSLmV2YWxSVm9pZChgXG4gICAgICAgIHdlYnI6Omluc3RhbGwocGtnLCByZXBvcyA9IHJlcG9zKVxuICAgICAgICBsaWJyYXJ5KHBrZywgY2hhcmFjdGVyLm9ubHkgPSBUUlVFKVxuICAgICAgYCwgeyBlbnY6IHtcbiAgICAgICAgcGtnOiBwa2csXG4gICAgICAgIHJlcG9zOiBkYXRhLnBhY2thZ2VzLnJlcG9zLFxuICAgICAgfX0pO1xuICAgIH0pLnJlZHVjZSgoY3VyLCBuZXh0KSA9PiBjdXIudGhlbihuZXh0KSwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuXG4gICAgLy8gRG93bmxvYWQgYW5kIGluc3RhbGwgcmVzb3VyY2VzXG4gICAgYXdhaXQgZmlsZXMubWFwKChmaWxlKSA9PiBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBuYW1lID0gZmlsZS5zdWJzdHJpbmcoZmlsZS5sYXN0SW5kZXhPZignLycpICsgMSk7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHJlc291cmNlOiAke25hbWV9YDtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmlsZSk7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2FuJ3QgZG93bmxvYWQgXFxgJHtmaWxlfVxcYC4gRXJyb3IgJHtyZXNwb25zZS5zdGF0dXN9OiBcIiR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1cIi5gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpO1xuXG4gICAgICAvLyBTdG9yZSBVUkxzIGluIHRoZSBjd2Qgd2l0aG91dCBhbnkgc3ViZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgaWYgKGZpbGUuaW5jbHVkZXMoXCI6Ly9cIikpIHtcbiAgICAgICAgZmlsZSA9IG5hbWU7XG4gICAgICB9XG5cbiAgICAgIC8vIENvbGxhcHNlIGhpZ2hlciBkaXJlY3Rvcnkgc3RydWN0dXJlXG4gICAgICBmaWxlID0gY29sbGFwc2VQYXRoKGZpbGUpO1xuXG4gICAgICAvLyBDcmVhdGUgZGlyZWN0b3J5IHRyZWUsIGlnbm9yaW5nIFwiZGlyZWN0b3J5IGV4aXN0c1wiIFZGUyBlcnJvcnNcbiAgICAgIGNvbnN0IHBhcnRzID0gZmlsZS5zcGxpdCgnLycpLnNsaWNlKDAsIC0xKTtcbiAgICAgIGxldCBwYXRoID0gJyc7XG4gICAgICB3aGlsZSAocGFydHMubGVuZ3RoID4gMCkge1xuICAgICAgICBwYXRoICs9IHBhcnRzLnNoaWZ0KCkgKyAnLyc7XG4gICAgICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgd2ViUi5GUy5hbmFseXplUGF0aChwYXRoKTtcbiAgICAgICAgaWYgKCFhbmFseXNpcy5leGlzdHMpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgd2ViUi5GUy5ta2RpcihwYXRoKTtcbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGVzeXN0ZW0gRXJyb3I6IFwiJHtlLm1lc3NhZ2V9XCIuYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFdyaXRlIHRoaXMgZmlsZSB0byB0aGUgVkZTXG4gICAgICByZXR1cm4gYXdhaXQgd2ViUi5GUy53cml0ZUZpbGUoZmlsZSwgbmV3IFVpbnQ4QXJyYXkoZGF0YSkpO1xuICAgIH0pLnJlZHVjZSgoY3VyLCBuZXh0KSA9PiBjdXIudGhlbihuZXh0KSwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuXG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBJbnN0YWxsaW5nIHdlYlIgc2hpbXNgO1xuICAgIGF3YWl0IHdlYlIuZXZhbFJWb2lkKGB3ZWJyOjpzaGltX2luc3RhbGwoKWApO1xuXG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBXZWJSIGVudmlyb25tZW50IHNldHVwYDtcbiAgICBhd2FpdCBzZXR1cFIod2ViUiwgZGF0YSk7XG5cbiAgICBzdGF0dXNUZXh0LnJlbW92ZSgpO1xuICAgIGlmIChzdGF0dXNDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID09IDApIHtcbiAgICAgIHN0YXR1c0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gd2ViUjtcbiAgfSkobmV3IFdlYlIoZGF0YS5vcHRpb25zKSk7XG5cbiAgLy8gS2VlcCB0cmFjayBvZiBpbml0aWFsIE9KUyBibG9jayByZW5kZXJcbiAgY29uc3QgcmVuZGVyZWRPanMgPSB7fTtcblxuICBjb25zdCBwcm9jZXNzID0gYXN5bmMgKGNvbnRleHQsIGlucHV0cykgPT4ge1xuICAgIGNvbnN0IHdlYlIgPSBhd2FpdCB3ZWJSUHJvbWlzZTtcbiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgV2ViUkV2YWx1YXRvcih3ZWJSLCBjb250ZXh0KVxuICAgIGF3YWl0IGV2YWx1YXRvci5wcm9jZXNzKGlucHV0cyk7XG4gICAgcmV0dXJuIGV2YWx1YXRvci5jb250YWluZXI7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb2Nlc3MsXG4gICAgd2ViUlByb21pc2UsXG4gICAgcmVuZGVyZWRPanMsXG4gIH07XG59XG4ifV19
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script>


</section>

</main> <!-- /main -->
<script>



/* definition of content for the buttons */

const webex_buttons = {check_hidden:          "<b>&check;</b>",

                       check_hidden_alt:      "Check answer",

                       check_shown:           "<b>&lsh;</b>",

                       check_shown_alt:       "Hide check",

                       check_of_total:        "/",

                       solution:              "<b>&quest;</b>",

                       solution_alt:          "Correct solution",

                       question_next:         "<b>&#8634;</b>",

                       question_next_alt:     "Next question",

                       question_previous:     "",

                       question_previous_alt: ""}





/* update total correct if #webex-total_correct exists */

update_total_correct = function() {

  console.log("webex: update total_correct");



  document.querySelectorAll(".webex-total_correct").forEach(total => {

    p = total.closest(".webex-box");

    var correct = p.getElementsByClassName("webex-correct").length;

    var solvemes = p.getElementsByClassName("webex-solveme").length;

    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;

    var selects = p.getElementsByClassName("webex-select").length;

    /* no specific class on input node, thus searching via query selector */

    var checkboxgroups = p.querySelectorAll("div[class=webex-checkboxgroup] input[type=checkbox]").length



    /* show number of correct / total number of answers */

    total.innerHTML = correct + "&nbsp;" + webex_buttons.check_of_total + "&nbsp;" + (solvemes + radiogroups + checkboxgroups + selects);

  });

}



/* check answers */

check_func = function() {

  console.log("webex: check answer");



  //var cl = elem.parentElement.classList;

  var cl = this.closest(".webex-box").classList;

  if (cl.contains("unchecked")) {

    cl.remove("unchecked");

    this.innerHTML = webex_buttons.check_shown; //"Hide check";

    if (webex_buttons.check_shown_alt.length > 0) this.setAttribute("title", webex_buttons.check_shown_alt);

  } else {

    cl.add("unchecked");

    this.innerHTML = webex_buttons.check_hidden; //"Check answer";

    if (webex_buttons.check_hidden_alt.length > 0) this.setAttribute("title", webex_buttons.check_hidden_alt);

  }

}



/* helper functions for checking the webex ID */

const id_checker = {"fmt": new RegExp("[g-zG-Z]"),

                    "load": function(e) { return e.getAttribute("id").match("(?<=(-)).*$")[0]; },

                    "eval": new TextEncoder(),

                    "dval": new TextDecoder()}



/* Show/hide correct solution */

solution_func = function() {

  console.log("webex: show/hide solution");



  var div = this.closest(".webex-question").querySelector(".webex-solution");

  var cl = div.classList;



  if (cl.contains("visible")) {

    cl.remove("visible");

  } else {

    cl.add("visible");

  }

}



/* function to check if the real answer is numeric */

convert_to_numeric = function(x) {

  if (typeof x == "string") {

    /* do nothing */

  } else if (x.length == 1) {

    /* take first element */

    x = x[0]

  } else {

    return NaN;

  }



  /* remove spaces for easier parsing */

  x = x.replace(/\s/g, "");



  /* Define patterns for different formats, note that spaces have been removed above */

  const patterns = [

    {regex: /^[+-]?\d+(\.\d{3})*,\d+$/, decimal: ",", thousand: "." },  // Format: "1.100.100.100,3"

    {regex: /^[+-]?\d+(,\d{3})*\.\d+$/, decimal: ".", thousand: "," },  // Format: "1,100,100,100.3"

    {regex: /^[+-]?\d+(\.|\.\d+)?$/, decimal: "." },                    // Format: "1100100100.5" or "1100100100."

    {regex: /^[+-]?\d+(,|,\d+)$/, decimal: "," }                        // Format: "1100100100,5" or "1100100100,"

  ];





  /* testing all regular expressions, convert to float if possible */

  for (const { regex, decimal, thousand } of patterns) {

    if (regex.test(x)) {

      let numeric = x;

      if (thousand) numeric = numeric.replace(new RegExp(`\\${thousand}`, "g"), "");

      numeric = numeric.replace(decimal, ".");

      return parseFloat(numeric);

    }

  }



  /* input of length 1 but none of the known formats, return NaN */

  return NaN;

}



/* Checking webex ID, returns formalsol */

check_id = function(e) {

  /* loading webex ID */

  var id = id_checker["load"](e);



  /* extracting answer */

  let answer = e.dataset.answer;



  /* checking unique id, prepare and return array */

  if (!id_checker["fmt"].test(id)) {

    const a = id_checker["eval"].encode(atob(answer));

    const b = id_checker["eval"].encode(id);

    const res = a.map((byte, index) => byte^b[index % b.length]);

    answer = id_checker["dval"].decode(res);

    /* Replacing &amp; with ' before parsing */

    answer = answer.replaceAll("&apos;", "'");

  }



  return JSON.parse(answer);

}



/* function for checking solveme answers */

solveme_func = function(e) {

  /* avoid that keyup and keychange twice execute this function within nms = 10

   * ms, clearing inputTimer and add timeout */

  console.log("webex: check solveme");



  /* float, precision for checking numeric answers */

  const eps = 0.00000000000001;



  /* get last checked user answer */

  const question = this.closest(".webex-question")



  /* extracting classes */

  var cl = this.classList;

  var my_answer = this.value;



  /* extracting classes */

  var cl = this.classList;



  /* empty answer? Job done */

  if (my_answer == "") {

    cl.remove("webex-correct");

    cl.remove("webex-incorrect");

    return false;

  }



  /* Find closest (parent) webex-question */

  let formalsols = check_id(this)



  /* by default we assume the users' answer is incorrect */

  var user_answer_correct = false;



  /* check if the correct answer is numeric, i.e. if 

   * formalsols is of length 1 containing one single numeric

   * value in a known format, else, NaN is returned */

  const num_formalsol = convert_to_numeric(formalsols);

  const num_my_answer = convert_to_numeric(my_answer);



  /* if the correct answer is numeric (float), the user's answer

   * must also be numeric. If not, it is wrong. Else we can

   * compare floating point numbers */

  if (!isNaN(num_formalsol) && !isNaN(num_my_answer)) {

    /* check if the real answer and the user input are numerically the same;

     * adding 'delta' to avoid precision issues */

    var diff = Math.abs(num_formalsol - num_my_answer);

    if (diff < parseFloat(this.dataset.tol) + eps) { user_answer_correct = true; }



  /* if the question contains regex, a regular expression is used

   * to evaluate the users answer. Allows for multiple regular expressions */

  } else if (cl.contains("regex")) {

    for (let i = 0; i < formalsols.length; i++) {

        let regex = new RegExp(formalsols[i], cl.contains("ignorecase") ? "i" : "");

        if (regex.test(my_answer)) { user_answer_correct = true; break; }

    }



  /* else we evaluate on 'string level', considering the creators preferences

   * regarding set options */

  } else {

    /* modify/prepare answer */

    if (cl.contains("ignorecase")) { my_answer = my_answer.toLowerCase(); }

    if (cl.contains("nospaces"))   { my_answer = my_answer.replace(/ /g, ""); }



    /* if the real answer includes user input - correct */

    if (formalsols.includes(my_answer)) {

      user_answer_correct = true;

  

      // added regex bit

      if (cl.contains("regex")) {

        answer_regex = RegExp(formalsols.join("|"))

        if (answer_regex.test(my_answer)) {

          cl.add("webex-correct");

        }

      }

    }

  }



  if (user_answer_correct) {

      cl.add("webex-correct");

      cl.remove("webex-incorrect");

  } else {

      cl.add("webex-incorrect");

      cl.remove("webex-correct");

  }



  update_total_correct();



}



/* function for checking select answers */

select_func = function(e) {

  console.log("webex: check select");



  var options   = [];

  Array.from(this.querySelectorAll("option")).forEach((option, index) => {

    if (!option.hasAttribute("value") || !option.getAttribute("value") === "blank") {

      options.push(option);

    }

  });



  /* get selected option */

  function get_selected(options) { return options.findIndex(option => option.selected); }

  var option_index = get_selected(options)



  /* loading webex ID */

  var formalsol = check_id(this)



  /* add class for current selection */

  this.classList.remove("webex-incorrect");

  this.classList.remove("webex-correct");

  if (option_index >= 0) {

    this.classList.add(formalsol[option_index] === 1 ? "webex-correct" : "webex-incorrect");

  }



  update_total_correct();

}



/* function for checking radiogroups answers */

radiogroups_func = function(e) {

  console.log("webex: check radiogroups");



  /* get real answer (binary integer array) */

  var id = e.target.getAttribute("name");

  var group = document.querySelector(".webex-radiogroup[id='webex-" + id + "']");

  var formalsol = check_id(group)



  /* check which radiobuttion is selected (user answer) */

  function get_checked(radios) {

    return radios.findIndex(radios => radios.checked);

  }

  var radios = Array.from(group.querySelectorAll("input[type='radio']"))

  var radio_index = get_checked(radios);



  /* remove existing classes */

  radios.forEach(radio => {

    let cl = radio.closest("label").classList

    cl.remove("webex-incorrect");

    cl.remove("webex-correct");

  });



  /* add class for current selection */

  let cl = radios[radio_index].closest("label").classList

  if (formalsol[radio_index] === 1) {

      cl.add("webex-correct");

  } else {

      cl.add("webex-incorrect");

  }



  update_total_correct();

}





/* function for checking checkboxgroups answers */

checkboxgroups_func = function(e) {

  console.log("webex: check checkboxgroups");



  /* get real answer (binary integer array) */

  var group = document.querySelector(".webex-checkboxgroup[id='" + this.id + "']");

  var formalsol = check_id(group);



  /* check which checkbox is checked (user answer) */

  function get_checked(group) {

      const checkboxes = Array.from(group.querySelectorAll("input[type='checkbox']"));

      return checkboxes.reduce((indices, checkbox, index) => {

          if (checkbox.checked) indices.push(index);

          return indices;

      }, []);

  }

  var checks = Array.from(group.querySelectorAll("input[type='checkbox']"));

  var check_index = get_checked(group);



  checks.forEach((e, index) => {

    var label = e.parentNode;

    var ans = formalsol[index];

    if ((e.checked && ans === 1) || (!e.checked && ans === 0)) {

        label.setAttribute("class", "webex-correct")

    } else {

        label.setAttribute("class", "webex-incorrect")

    }

  });



  update_total_correct();

}



/* shuffling array (thanks to stack overflow)

 * If argument x is an integer we create an integer sequence

 * from 0, 1, ..., (x - 1) and return a shuffled version. If

 * the input is an array, we simply shuffle it */

shuffle_array = function(x) {

   if (Number.isInteger(x) && !isNaN(x)) {

     x = Array.from({length: x}, (v, i) => i);

   }

   let shuffled = x.map(value => ({ value, sort: Math.random() }))

        .sort((a, b) => a.sort - b.sort).map(({ value }) => value)

   return shuffled;

}



/* ---------------------------------------------------------

 * ---------------------------------------------------------

 * --------------------------------------------------------- */

window.onload = function() {

  //console.log("webex: onload");



  /* setting up buttons and actions to show/hide answers */

  document.querySelectorAll(".webex-check").forEach(section => {

    section.classList.add("unchecked");



    /* ul to take up the list items with buttons */

    let button_ul = document.createElement("ul");

    button_ul.setAttribute("class", "webex-button-list");

    section.appendChild(button_ul);



    /* button to _check_ if answers given are correct */

    let li_check = document.createElement("li");

    button_ul.appendChild(li_check); /* add list item to ul */

    let btn_check = document.createElement("button");

    btn_check.innerHTML = webex_buttons.check_hidden;  // "Check answer";

    btn_check.setAttribute("class", "webex-button webex-button-check");

    if (webex_buttons.check_hidden_alt.length > 0) btn_check.setAttribute("title", webex_buttons.check_hidden_alt);

    btn_check.onclick = check_func;

    li_check.appendChild(btn_check);



    /* span to show current number of points (when _check_ active) */

    let spn = document.createElement("span");

    spn.classList.add("webex-total_correct");

    li_check.appendChild(spn);



    /* button to show the _solution_ if there is one */

    var has_solution = section.parentNode.querySelectorAll(".webex-solution").length > 0;

    if (has_solution) {

      let li_solution = document.createElement("li");

      button_ul.appendChild(li_solution); /* add list item to ul */

      let btn_solution = document.createElement("button");

      btn_solution.innerHTML = webex_buttons.solution; // "Correct answer";

      btn_solution.setAttribute("class", "webex-button webex-button-solution");

      if (webex_buttons.solution_alt.length > 0) btn_solution.setAttribute("title", webex_buttons.solution_alt);

      btn_solution.onclick = solution_func;

      li_solution.appendChild(btn_solution);

    }



  });



  /* set up webex-solveme inputs */

  document.querySelectorAll(".webex-solveme").forEach(solveme => {

    solveme.setAttribute("autocomplete","off");

    solveme.setAttribute("autocorrect", "off");

    solveme.setAttribute("autocapitalize", "off");

    solveme.setAttribute("spellcheck", "false");

    solveme.value = "";



    /* adjust answer for 'no spaces' (ignore spaces) */

    if (solveme.classList.contains("nospaces")) {

      solveme.dataset.answer = solveme.dataset.answer.replace(/ /g, "");

    }



    /* attach checking function, triggered on key up, change, and when

     * elemnt is out of focus. Only evaluated once by tracking changes

     * via variable solveme_last_user_answer */

    solveme.addEventListener("keyup",  solveme_func);

    solveme.addEventListener("change", solveme_func);

    solveme.addEventListener("blur",   solveme_func);



    /* adding span to show correct/incorrect icon */

    solveme.insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")

  });



  /* set up radiogroups (single choice questions with display = "buttons") */

  document.querySelectorAll(".webex-radiogroup").forEach(radiogroup => {

    radiogroup.onchange = radiogroups_func;

  });



  /* set up checkboxgroups (multiple choice questions with display = "buttons") */

  document.querySelectorAll(".webex-checkboxgroup").forEach(checkboxgroup => {

    checkboxgroup.onchange = checkboxgroups_func;

  });



  /* set up selects (dropdown menus) */

  document.querySelectorAll(".webex-select").forEach(select => {

    select.onchange = select_func;

    /* append webex-icon for correct/incorrect icons */

    var elem = document.createElement("span")

    elem.classList.add("webex-icon")

    select.parentNode.appendChild(elem)

  });



  /* change to next/previous question if multiple are available */

  function handleQuestionClick(group, questions, step) {

    return async function() {

      /* get question order as integer vector */

      let questionOrder = group.dataset.questionOrder.split(",").map(str => parseInt(str));



      /* current question/position */

      let currentPosition = parseInt(group.dataset.currentPosition);



      /* Hide the current question */

      questions.forEach(question => { question.classList.remove("active"); });



      /* Move to the next question index */

      currentPosition = (currentPosition + step) % questionOrder.length;

      if (currentPosition < 0) currentPosition = currentPosition + questionOrder.length



      /* Display the new question */

      questions[questionOrder[currentPosition]].classList.add("active");



      // Update the currentPosition data attribute on the group div

      group.dataset.currentPosition = currentPosition;

    };

  }



  document.querySelectorAll(".webex-group").forEach(group => {

    const questions = Array.from(group.querySelectorAll(".webex-question"));



    /* Create vector with question order. If the webex-group does

     * not have class '.noshuffle' we will randomly shuffle the order */

    let questionOrder = Array.from({length: questions.length}, (v, i) => i);

    if (!group.classList.contains("noshuffle")) {

      questionOrder = shuffle_array(questionOrder);

    }



    /* take start position (if set) or start at 0 */

    const currentPosition = parseInt(group.getAttribute("data-start-position")) || 0;



    /* show the default question for each group */

    questions[questionOrder[currentPosition]].classList.add("active");



    /* store random order of questions as well as current position */

    group.dataset.questionOrder   = questionOrder;

    group.dataset.currentPosition = currentPosition;



    /* find all webex-questions, search for .webex-button-list and

     * populate the list with necessary <li><button>...</button></li> elements */

    questions.forEach(question => {

        let button_ul = question.querySelector("ul.webex-button-list");



        let li_next = document.createElement("li");

        let nextButton = document.createElement("button");

        nextButton.setAttribute("class", "webex-button webex-button-next");

        if (webex_buttons.question_next_alt.length > 0) nextButton.setAttribute("title", webex_buttons.question_next_alt);

        nextButton.innerHTML = webex_buttons.question_next; // "Next question";

        nextButton.addEventListener("click", handleQuestionClick(group, questions, 1));

        li_next.appendChild(nextButton);



        let li_previous = document.createElement("li");

        let previousButton = document.createElement("button");

        previousButton.setAttribute("class", "webex-button webex-button-previous");

        if (webex_buttons.question_previous_alt.length > 0) previousButton.setAttribute("title", webex_buttons.question_previous_alt);

        previousButton.innerHTML = webex_buttons.question_previous; // "Previous question";

        previousButton.addEventListener("click", handleQuestionClick(group, questions, -1));

        li_previous.appendChild(previousButton);



        if (webex_buttons.question_previous.length > 0) button_ul.appendChild(li_previous);

        if (webex_buttons.question_next.length > 0) button_ul.appendChild(li_next);

    });

  });



  /* Development options */

  document.querySelectorAll(".webex-question.check").forEach(question => {

      question.querySelector(".webex-button-check").click()

  });

  document.querySelectorAll(".webex-question.solution").forEach(question => {

      let btn = question.querySelector(".webex-button-solution");

      if (btn !== null) { btn.click(); }

  });



  /* Pre-filling <input> fields */

  document.querySelectorAll(".webex-question.prefill").forEach(question => {

      question.querySelectorAll("input.webex-solveme").forEach(solveme => {

          let x = JSON.parse(solveme.dataset.answer);

          solveme.value = x[0];

          /* Trigger the on change event */

          solveme.dispatchEvent(new Event("change"));

      });



      /* Pre-filling radiogroups, that is for schoice questions */

      question.querySelectorAll(".webex-radiogroup").forEach(radiogroup => {

          let x = JSON.parse(radiogroup.dataset.answer);

          let idx = x.indexOf(1);

          let radios = radiogroup.querySelectorAll('input[type="radio"]');

          radios[idx].checked = true;

          /* Trigger the on change event */

          radios[idx].dispatchEvent(new Event("change", { bubbles: true }));

      });



      /* Pre-filling checkboxgroups, that is for schoice questions w/ dropdown menus */

      question.querySelectorAll(".webex-select").forEach(dropdown => {

          let x = JSON.parse(dropdown.dataset.answer);

          let idx = x.indexOf(1) + 1; /* +1 to skip the first blank option */

          let options = dropdown.querySelectorAll("option");

          options[idx].selected = true;

          /* Trigger the on change event */

          options[idx].dispatchEvent(new Event("change", { bubbles: true }));

      });



      /* Pre-filling checkboxgroups, that is for mchoice questions */

      question.querySelectorAll(".webex-checkboxgroup").forEach(radiogroup => {

          let x = JSON.parse(radiogroup.dataset.answer);

          let checkboxes = radiogroup.querySelectorAll('input[type="checkbox"]');

          for (let i = 0; i < checkboxes.length; i++) {

              checkboxes[i].checked = x[i];

          }

          /* Trigger the on change event */

          checkboxes[0].dispatchEvent(new Event("change", { bubbles: true }));

      });

  });



  /* Show set tolerance (devel option) */

  function calc_width(x, txt, offset = 20) {

      /* We do the following:

       * Create a new span, insert the value we need in the .tolerance

       * input node, and calculate its offsetWidth. Then remove it

       * again; this is just used to calculate the required width. */

      var cwtmp = document.createElement("span");

      x.appendChild(cwtmp);

      cwtmp.innerHTML = txt || "";

      var w = parseInt(cwtmp.getBoundingClientRect().width) + offset;

      cwtmp.remove();

      return w;

  }



  /* If tolerance should be shown (devel option) we calculate:

   * - the width required to properly display the solution

   * - the width required to properly display the tolerance

   * - add a new element to display the tolerance

   * - reduce the width of the solution input box. */

  document.querySelectorAll(".webex-question.tolerance").forEach(question => {

      question.querySelectorAll("input[data-tol]").forEach(elem => {

          var w = null;



          /* Add new element showing the tolerance */

          let tol = document.createElement("input");

          tol.type = "text"; // <inpyt type="text">

          tol.disabled = true; // Disable input element

          tol.classList.add("tolerance"); // Appending class

          tol.value = "Â± " + elem.getAttribute("data-tol");



          /* Add new node */

          elem.parentNode.insertBefore(tol, elem)



          var body     = document.querySelector("body");

          //tol.value = "Â± " + "0.0000007";

          //tol.value = "Â± " + "0.07";

          w    = calc_width(body, tol.value);

          wold = parseInt(elem.getBoundingClientRect().width);

          wmin = calc_width(body, elem.value);



          /* Calculate required width of the 'tolerance' node, and the

           * reduction of the original 'input' node */

          let wnew = Math.max(wmin, wold - w);

          tol.style.width  = w + "px";

          elem.style.width = wnew + "px";

      });

  });



  update_total_correct();

}



</script>



<script>

if (window.location.href.includes('displayall')) {

  document.body.id = 'displayall';

} else {

  document.body.id = 'progressive';

}

</script>
<script>
(function () {
  function markComplete(exId) {
    document.querySelectorAll('.cell.wait[data-check="true"][data-exercise="' + exId + '"]').forEach(function (el) {
      el.setAttribute('data-complete', 'true');
    });
  }

  function handleGradeNode(node) {
    if (!(node instanceof Element)) return;
    if (node.classList.contains('exercise-grade') && node.classList.contains('alert-success')) {
      var host = node.closest('[data-exercise]');
      var exId = host && host.getAttribute('data-exercise');
      if (exId) markComplete(exId);
    } else if (node.querySelectorAll) {
      node.querySelectorAll('.exercise-grade.alert-success').forEach(function (child) {
        var host = child.closest('[data-exercise]');
        var exId = host && host.getAttribute('data-exercise');
        if (exId) markComplete(exId);
      });
    }
  }

  function scanExisting() {
    document.querySelectorAll('.exercise-grade.alert-success').forEach(handleGradeNode);
  }

  document.addEventListener('DOMContentLoaded', function () {
    // Initial pass for any pre-rendered success states
    scanExisting();
    // Observe dynamically added grade alerts
    var mo = new MutationObserver(function (mutations) {
      mutations.forEach(function (m) {
        m.addedNodes && m.addedNodes.forEach(handleGradeNode);
      });
    });
    mo.observe(document.body, { childList: true, subtree: true });
  });
})();
</script>

<script>
(function () {
  const STORAGE_KEY = 'exercise-skip:v1';

  function loadState() {
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); }
    catch { return {}; }
  }

  function saveState(state) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function pageKeyPrefix() {
    return location.pathname + '::';
  }

  function isSkipped(state, exId) {
    return !!state[pageKeyPrefix() + exId];
  }

  function setSkipped(state, exId, skipped) {
    const key = pageKeyPrefix() + exId;
    if (skipped) state[key] = true; else delete state[key];
    saveState(state);
  }

  function applySkipAttr(el, skipped) {
    if (skipped) {
      el.setAttribute('data-skip', 'true');
      el.setAttribute('data-complete', 'true');
    } else {
      el.removeAttribute('data-skip');
      // Only remove data-complete if this cell wasn't actually completed
      // by grading (has a success alert). If it was graded, leave complete.
      const graded = !!el.querySelector('.exercise-grade.alert-success');
      if (!graded) el.removeAttribute('data-complete');
    }
  }

  function buildButton(el, state, exId) {
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn btn-sm btn-outline-secondary skip-exercise-btn';
    const skipped = isSkipped(state, exId);
    btn.textContent = skipped ? 'Undo skip' : 'Skip exercise';
    btn.setAttribute('aria-pressed', skipped ? 'true' : 'false');
    btn.style.margin = '0.5rem 0';

    btn.addEventListener('click', function () {
      const nowSkipped = btn.getAttribute('aria-pressed') !== 'true';
      applySkipAttr(el, nowSkipped);
      setSkipped(state, exId, nowSkipped);
      btn.textContent = nowSkipped ? 'Undo skip' : 'Skip exercise';
      btn.setAttribute('aria-pressed', nowSkipped ? 'true' : 'false');
    });
    return btn;
  }

  document.addEventListener('DOMContentLoaded', function () {
    const state = loadState();
    document.querySelectorAll('.cell.wait[data-check="true"]').forEach(function (cell) {
      const exId = cell.getAttribute('data-exercise');
      if (!exId) return;

      // Reapply stored skip state
      applySkipAttr(cell, isSkipped(state, exId));

      // Insert the button just before the exercise cell
      const btn = buildButton(cell, state, exId);
      const parent = cell.parentElement || cell;
      parent.insertBefore(btn, cell);
    });
  });
})();
</script>

<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InggPSBBcnJheS5mcm9tKHtsZW5ndGg6IDEwfSwgZDMucmFuZG9tTm9ybWFsKDAsNCApKVxubm9pc2UgPSBBcnJheS5mcm9tKHtsZW5ndGg6IDUwfSwgZDMucmFuZG9tTm9ybWFsKDAsIDIpKVxueSA9IHgubWFwKCh4aSwgaSkgPT4gMC41ICogeGkgLSAzICsgbm9pc2VbaV0pXG5cbnhSYW5nZSA9IGQzLmV4dGVudCh4KVxuXG5cbmxpbmVhckRhdGEgPSB4Lm1hcCgoeGksIGkpID0+ICh7IHg6IHhpLCB5OiB5W2ldIH0pKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGIwYWRqXzEgPSBJbnB1dHMucmFuZ2UoWy01LCA1XSwge3N0ZXA6IDEsIGxhYmVsOiBodG1sYCR7dGV4YFxcaGF0e1xcYmV0YV8wfWB9OiBFc3RpbWF0ZWQgSW50ZXJjZXB0IChhc2p1c3QpYH0pXG52aWV3b2YgYjFfMSA9IElucHV0cy5yYW5nZShbLTIsIDJdLCB7c3RlcDogMC4wMSwgbGFiZWw6ICBodG1sYCR7dGV4YFxcaGF0e1xcYmV0YV8xfWB9OiBFc3RpbWF0ZWQgU2xvcGVgfSlcblxuYjBfMSA9ICgtMyAtIDAuNSpiMV8xKSArIGIwYWRqXzFcblxudGV4LmJsb2NrYFxcaGF0e1l9ID0gJHtiMF8xfSArICR7YjFfMX14YFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibGluZURhdGFfMSA9IHhSYW5nZS5tYXAoeCA9PiAoe3gsIHk6IGIxXzEgKiB4ICsgYjBfMX0pKVxuXG5QbG90LnBsb3Qoe1xuICBtYXJrczogW1xuICAgIFBsb3QubGluZShsaW5lRGF0YV8xLCB7IHg6IFwieFwiLCB5OiBcInlcIiB9KSxcblxuICAgIFBsb3QuZG90KGxpbmVhckRhdGEsIHsgeDogXCJ4XCIsIHk6IFwieVwiLCByOiAzIH0pXG4gIF0sXG4gIHg6IHsgZG9tYWluOiB4UmFuZ2UgfSxcbiAgeTogeyBkb21haW46IFstMTAsIDVdLCBsYWJlbDogXCJ5XCIgfSxcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0ZXguYmxvY2tgXFxoYXR7WX0gPSAke2JldGFfMF9oYXR9ICsgJHtiZXRhXzFfaGF0fVxcY2RvdCBYYFxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGIwYWRqID0gSW5wdXRzLnJhbmdlKFstNSwgNV0sIHtzdGVwOiAxLCBsYWJlbDogaHRtbGAke3RleGBcXGhhdHtcXGJldGFfMH1gfTogRXN0aW1hdGVkIEludGVyY2VwdGB9KVxudmlld29mIGIxID0gSW5wdXRzLnJhbmdlKFstMiwgMl0sIHtzdGVwOiAwLjAxLCBsYWJlbDogIGh0bWxgJHt0ZXhgXFxoYXR7XFxiZXRhXzF9YH06IEVzdGltYXRlZCBTbG9wZWB9KVxuXG5iMCA9IC0zICsgYjBhZGpcblxucmVzaWR1YWxEYXRhID0gbGluZWFyRGF0YS5tYXAoZCA9PiB7XG4gIGNvbnN0IHloYXQgPSBiMSAqIGQueCArIGIwO1xuICBjb25zdCByZXMgID0gZC55IC0geWhhdDtcbiAgcmV0dXJuIHtcbiAgICAuLi5kLFxuICAgIHloYXQsXG4gICAgcmVzaWR1YWw6IHJlcyxcbiAgICBzaWduOiByZXMgPj0gMCA/IFwicG9zaXRpdmVcIiA6IFwibmVnYXRpdmVcIixcbiAgICBhYnNSZXM6IE1hdGguYWJzKHJlcylcbiAgfTtcbn0pXG4gIFxuU1NSZXMgPSBkMy5zdW0ocmVzaWR1YWxEYXRhLCBkID0+IGQucmVzaWR1YWwgKiogMilcblxudGV4LmJsb2NrYFxcaGF0e1l9ID0gJHtiMX1YICsgJHtiMH1gXG5cbnRleC5ibG9ja2BcXHN1bV97aX1yX2leezJ9ID0gJHtTU1Jlcy50b0ZpeGVkKDIpfWBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImxpbmVEYXRhID0geFJhbmdlLm1hcCh4ID0+ICh7eCwgeTogYjEgKiB4ICsgYjB9KSlcblxuUGxvdC5wbG90KHtcbiAgbWFya3M6IFtcbiAgICBQbG90LnJ1bGVYKHJlc2lkdWFsRGF0YSwge3g6IFwieFwiLFxuICAgICAgeTE6IFwieVwiLFxuICAgICAgeTI6IFwieWhhdFwiLFxuICAgICAgc3Ryb2tlOiBcInNpZ25cIiwgXG4gICAgICBzdHJva2VPcGFjaXR5OiAwLjc1LFxuICAgICAgc3Ryb2tlV2lkdGg6IGQgPT4gMSArIGQucmVzaWR1YWwqKjJ9KSxcblxuICAgIFBsb3QubGluZShsaW5lRGF0YSwgeyB4OiBcInhcIiwgeTogXCJ5XCIgfSksXG5cbiAgICBQbG90LmRvdChsaW5lYXJEYXRhLCB7IHg6IFwieFwiLCB5OiBcInlcIiwgcjogMyB9KVxuICBdLFxuICB4OiB7IGRvbWFpbjogeFJhbmdlIH0sXG4gIHk6IHsgZG9tYWluOiBbLTEwLDVdLCBsYWJlbDogXCJ5XCIgfSxcbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2IwYWRqXzEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYjFfMScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdiMGFkaicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdiMScpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../..";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>